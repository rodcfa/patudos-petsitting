import{c as z}from"./index-C_6bkvJA.js";const T="https://ntvpbxdnjslfwhezjoah.supabase.co",O="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50dnBieGRuanNsZndoZXpqb2FoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1OTg2NDQsImV4cCI6MjA2NzE3NDY0NH0.zN37OSZOX-Ylp2Qv7UDw3w4TMdJOvPPgJhTwi1wNBeg",E=z(T,O);let l=new Date,f=[];const v=document.getElementById("calendarDays"),$=document.getElementById("currentMonth"),J=document.getElementById("prevMonth"),V=document.getElementById("nextMonth"),q=document.getElementById("addClientBtn"),w=document.getElementById("modalOverlay"),H=document.getElementById("closeModal"),Y=document.getElementById("cancelBtn"),A=document.getElementById("agendamentoForm"),x=document.getElementById("loadingOverlay"),B=document.getElementById("dayDetailsModal"),j=document.getElementById("closeDayDetailsModal");document.getElementById("dayDetailsTitle");const Z=document.getElementById("dayDetailsDate"),R=document.getElementById("dayDetailsPetCount"),M=document.getElementById("dayDetailsPetsList"),L=document.getElementById("editModal"),X=document.getElementById("closeEditModal"),U=document.getElementById("cancelEditBtn"),P=document.getElementById("editAgendamentoForm"),Q=document.getElementById("deleteAgendamentoBtn"),F=document.getElementById("calendarViewBtn"),_=document.getElementById("dashboardViewBtn"),S=document.getElementById("dashboardSection"),k=document.querySelector(".main-content");document.addEventListener("DOMContentLoaded",function(){if(console.log("Patudos PetSitting - Ambiente de Testes Iniciado"),!G()){window.location.href="login.html";return}console.log("Conectado ao Supabase:",T),K()});function G(){return localStorage.getItem("adminLoggedIn")==="true"}async function K(){try{o(!0),await h(),g(),W(),o(!1),console.log("Aplicação inicializada com sucesso!")}catch(e){console.error("Erro ao inicializar aplicação:",e),o(!1),alert("Erro ao carregar dados. Verifique a conexão com o banco de dados.")}}function W(){J.addEventListener("click",()=>{l.setMonth(l.getMonth()-1),g()}),V.addEventListener("click",()=>{l.setMonth(l.getMonth()+1),g()}),q.addEventListener("click",()=>{ne()}),H.addEventListener("click",()=>{I()}),Y.addEventListener("click",()=>{I()}),j.addEventListener("click",()=>{b()}),X.addEventListener("click",()=>{p()}),U.addEventListener("click",()=>{p()}),A.addEventListener("submit",oe),P.addEventListener("submit",se),Q.addEventListener("click",ce),F.addEventListener("click",()=>N("calendar")),_.addEventListener("click",()=>N("dashboard")),w.addEventListener("click",e=>{e.target===w&&I()}),B.addEventListener("click",e=>{e.target===B&&b()}),L.addEventListener("click",e=>{e.target===L&&p()})}async function h(){try{const{data:e,error:t}=await E.from("agendamentos").select("*").order("data_inicio",{ascending:!0});if(t)throw t;f=e||[],console.log("Agendamentos carregados:",f.length)}catch(e){throw console.error("Erro ao carregar agendamentos:",e),e}}function g(){const e=l.getFullYear(),t=l.getMonth(),a=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];$.textContent=`${a[t]} ${e}`,v.innerHTML="";const n=new Date(e,t,1),i=new Date(e,t+1,0).getDate(),s=n.getDay(),D=new Date(e,t,0).getDate();for(let d=s-1;d>=0;d--){const y=C(D-d,!0);v.appendChild(y)}for(let d=1;d<=i;d++){const y=C(d,!1);v.appendChild(y)}const u=42-v.children.length;for(let d=1;d<=u;d++){const y=C(d,!0);v.appendChild(y)}}function C(e,t){const a=document.createElement("div");a.className="calendar-day",t&&a.classList.add("other-month");const n=new Date,c=l.getFullYear(),i=l.getMonth();!t&&e===n.getDate()&&i===n.getMonth()&&c===n.getFullYear()&&a.classList.add("today");const s=document.createElement("div");s.className="day-number",s.textContent=e;const m=document.createElement("div");if(m.className="day-pets",a.appendChild(s),a.appendChild(m),!t){const D=new Date(c,i,e),r=ee(D);if(r.length>0&&(r.length<=3?a.classList.add("occupancy-normal"):r.length===4?a.classList.add("occupancy-warning"):a.classList.add("occupancy-danger"),r.slice(0,3).forEach(u=>{const d=document.createElement("div");d.className="pet-item",d.textContent=u.nome_pet,m.appendChild(d)}),r.length>3)){const u=document.createElement("div");u.className="pet-count",u.textContent=r.length,a.appendChild(u)}a.addEventListener("click",()=>{te(D,r)})}return a}function ee(e){return f.filter(t=>{const a=new Date(t.data_inicio),n=new Date(t.data_fim);return a.setHours(0,0,0,0),n.setHours(23,59,59,999),e.setHours(12,0,0,0),e>=a&&e<=n})}function te(e,t){const a=e.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(Z.textContent=a,R.textContent=`${t.length} ${t.length===1?"pet":"pets"}`,M.innerHTML="",t.length===0){const n=document.createElement("div");n.className="empty-state",n.innerHTML=`
            <i class="fas fa-calendar-day"></i>
            <h4>Nenhum agendamento</h4>
            <p>Não há pets agendados para este dia.</p>
        `,M.appendChild(n)}else t.forEach(n=>{const c=ae(n);M.appendChild(c)});B.classList.add("active")}function ae(e){const t=document.createElement("div");t.className="pet-card";const a=new Date(e.data_inicio).toLocaleDateString("pt-BR"),n=new Date(e.data_fim).toLocaleDateString("pt-BR");return t.innerHTML=`
        <div class="pet-card-header">
            <div class="pet-name">
                <i class="fas fa-paw"></i>
                ${e.nome_pet}
            </div>
            <div class="pet-actions">
                <button class="btn-icon btn-edit" onclick="editAgendamento('${e.id}')" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon btn-delete" onclick="deleteAgendamento('${e.id}')" title="Excluir">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="pet-dates">
            <div class="pet-date-item">
                <i class="fas fa-sign-in-alt"></i>
                <span>Entrada: ${a}</span>
            </div>
            <div class="pet-date-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>Saída: ${n}</span>
            </div>
        </div>
        ${e.valor_por_dia?`<p><strong>Valor/dia:</strong> €${parseFloat(e.valor_por_dia).toFixed(2)}</p>`:""}
        ${e.observacoes?`<p><strong>Observações:</strong> ${e.observacoes}</p>`:""}
        <span class="pet-status">${e.status||"Confirmado"}</span>
    `,t}function ne(){A.reset();const e=new Date().toISOString().split("T")[0];document.getElementById("dataInicio").min=e,document.getElementById("dataFim").min=e,w.classList.add("active")}function I(){w.classList.remove("active")}function b(){B.classList.remove("active")}function p(){L.classList.remove("active")}async function oe(e){e.preventDefault();try{o(!0);const t=new FormData(A),a={nome_pet:t.get("nomePet"),data_inicio:t.get("dataInicio"),data_fim:t.get("dataFim"),valor_por_dia:parseFloat(t.get("valorPorDia"))||0,observacoes:t.get("observacoes")||null,status:"Confirmado"},n=new Date(a.data_inicio);if(new Date(a.data_fim)<=n){alert("A data de saída deve ser posterior à data de entrada."),o(!1);return}const{data:i,error:s}=await E.from("agendamentos").insert([a]).select();if(s)throw s;console.log("Agendamento criado:",i[0]),await h(),g(),I(),o(!1),alert("Agendamento criado com sucesso!")}catch(t){console.error("Erro ao criar agendamento:",t),o(!1),alert("Erro ao criar agendamento. Tente novamente.")}}async function de(e){try{const t=f.find(a=>a.id===e);if(!t){alert("Agendamento não encontrado.");return}document.getElementById("editAgendamentoId").value=t.id,document.getElementById("editNomePet").value=t.nome_pet,document.getElementById("editDataInicio").value=t.data_inicio,document.getElementById("editDataFim").value=t.data_fim,document.getElementById("editValorPorDia").value=t.valor_por_dia||"",document.getElementById("editObservacoes").value=t.observacoes||"",b(),L.classList.add("active")}catch(t){console.error("Erro ao editar agendamento:",t),alert("Erro ao carregar dados do agendamento.")}}async function se(e){e.preventDefault();try{o(!0);const t=new FormData(P),a=document.getElementById("editAgendamentoId").value,n={nome_pet:t.get("nomePet"),data_inicio:t.get("dataInicio"),data_fim:t.get("dataFim"),valor_por_dia:parseFloat(t.get("valorPorDia"))||0,observacoes:t.get("observacoes")||null},c=new Date(n.data_inicio);if(new Date(n.data_fim)<=c){alert("A data de saída deve ser posterior à data de entrada."),o(!1);return}const{data:s,error:m}=await E.from("agendamentos").update(n).eq("id",a).select();if(m)throw m;console.log("Agendamento atualizado:",s[0]),await h(),g(),p(),o(!1),alert("Agendamento atualizado com sucesso!")}catch(t){console.error("Erro ao atualizar agendamento:",t),o(!1),alert("Erro ao atualizar agendamento. Tente novamente.")}}async function ce(){if(confirm("Tem certeza que deseja excluir este agendamento? Esta ação não pode ser desfeita."))try{o(!0);const e=document.getElementById("editAgendamentoId").value,{error:t}=await E.from("agendamentos").delete().eq("id",e);if(t)throw t;console.log("Agendamento excluído:",e),await h(),g(),p(),o(!1),alert("Agendamento excluído com sucesso!")}catch(e){console.error("Erro ao excluir agendamento:",e),o(!1),alert("Erro ao excluir agendamento. Tente novamente.")}}function N(e){F.classList.remove("active"),_.classList.remove("active"),e==="calendar"?(F.classList.add("active"),k.style.display="block",S.style.display="none"):e==="dashboard"&&(_.classList.add("active"),k.style.display="none",S.style.display="block",ie())}async function ie(){try{o(!0);const e=re();document.getElementById("receitaTotal").textContent=`€${e.receitaTotal.toFixed(2)}`,document.getElementById("totalAgendamentos").textContent=e.totalAgendamentos,document.getElementById("totalDias").textContent=e.totalDias,document.getElementById("valorMedio").textContent=`€${e.valorMedio.toFixed(2)}`,le(e),o(!1)}catch(e){console.error("Erro ao carregar dashboard:",e),o(!1)}}function re(){let e=0,t=0;return f.forEach(a=>{const n=new Date(a.data_inicio),c=new Date(a.data_fim),i=Math.ceil((c-n)/(1e3*60*60*24)),s=parseFloat(a.valor_por_dia)||0;t+=i,e+=i*s}),{receitaTotal:e,totalAgendamentos:f.length,totalDias:t,valorMedio:t>0?e/t:0}}function le(e){console.log("Carregando gráficos com dados:",e)}function o(e){e?x.classList.add("active"):x.classList.remove("active")}window.editAgendamento=de;window.logout=me;window.deleteAgendamento=async function(e){if(confirm("Tem certeza que deseja excluir este agendamento?"))try{o(!0);const{error:t}=await E.from("agendamentos").delete().eq("id",e);if(t)throw t;await h(),g(),b(),o(!1),alert("Agendamento excluído com sucesso!")}catch(t){console.error("Erro ao excluir agendamento:",t),o(!1),alert("Erro ao excluir agendamento. Tente novamente.")}};function me(){confirm("Tem certeza que deseja sair?")&&(localStorage.removeItem("adminLoggedIn"),localStorage.removeItem("adminUser"),window.location.href="login.html")}
